<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Setting the content of paragraphs from data</title>
        <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
	</head>
	<body>
        <div class="flex-container">
        <div id="updatableChart1"></div>
        <div id="updatableChart2"></div>
        </div>
        <script type="text/javascript">

        /**/
        /* Define the Chart module */
        /**/
        function chartModule(data) {

            var height = 50;
            var width = 25;
            var gap = 10;
            var xlab = "y";
            var ylab = "z";

            /* Define the chart ctor */
            function chart(selection) {
                selection.each( function(data) {

                // overall svg
                svg = d3.select(this)
                    .append("svg")
                    .attr("id", "mainsvg")
                    .attr("height", height)
                    .attr("width", width + gap)

                // first svg
                svg = svg
                    .append("svg")
                    .attr("id", "svg")
                    .attr("height", height)
                    .attr("width", width)
            
                svg.append("rect")
                    .attr("height", height)
                    .attr("width", width)
                    .attr("stroke", "black")
                    .attr("fill", "#ccc")
                    .attr("stroke-width", 2)

                svg.selectAll("empty")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx", function(d) { return d[xlab]; })
                    .attr("cy", function(d) { return height-d[ylab]+10; })
                    .attr("class", function(d,i) { return "pt" + i; })
                    .attr("r", 5)
                    .attr("stroke", "black")
                    .attr("fill", "slateblue")
                    .on("mouseover", function(d, i) {
                        console.log(i)
                        d3.selectAll("circle.pt" + i)
                        .attr("fill", "Orchid")
                        .attr("r", 6)
                    })
                    .on("mouseout", function(d, i) {
                        d3.selectAll("circle.pt" + i)
                        .attr("fill", "slateblue")
                        .attr("r", 5)
                    })

                })
            }

            /* Define Setters and Getters */
            chart.width = function(_) {
                if (!arguments.length) return width;
                width = _;
                return chart;
            }

            chart.height = function(_) {
                if (!arguments.length) return height;
                height = _;
                return chart;
            }

            chart.xlab = function(_) {
                if (!arguments.length) return xlab;
                xlab = _;
                return chart;
            }

            chart.ylab = function(_) {
                if (!arguments.length) return ylab;
                ylab = _;
                return chart;
            }

            /* Return chart object */
            return chart;
        }

        // simulate some data
        var height = 50;
        var width = 25;
        var n_pts = 20;
        index = d3.range(n_pts);
        data = index.map(function(i) {
            w =   0.1*Math.random()*(width-10)+5;
            x = w*0.2 + Math.random()*height/2;
            y = w*0.3 + Math.random()*height/2;
            z = w*0.4 + Math.random()*height/2;
            return {w:w, x:x, y:y, z:z};
        });

        /**/
        /* select, bind, call */
        /**/
        var updatableChart1 = chartModule()
                                .width(100).height(100)
                                .xlab("w")
                                .ylab("x");
        d3.select('div#updatableChart1')
            .datum(data)
            .call(updatableChart1);

        var updatableChart2 = chartModule()
                                .width(100).height(100)
                                .xlab("y")
                                .ylab("z");
        d3.select('div#updatableChart2')
            .datum(data)
            .call(updatableChart2);


        //chartModule(data);

        </script>
	</body>
</html>